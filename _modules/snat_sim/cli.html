
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="../../_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="../../_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="../../_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../../_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>snat_sim.cli &#8212; Supernova Atmospheric Simulation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/guzzle.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom_style.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  
   

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">SNAT-SIM</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">snat_sim.cli</a></li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar"><a href="
    ../../index.html" class="text-logo">SNAT-SIM</a>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="../../search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Table Of Contents</h2>
  </div>
  <div class="sidebar-toc">
    
    
      <ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/install.html">Installation and Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/command_line.html">Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/data_model.html">Output Data Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/data_provenance.html">Data Provenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/integrations.html">Package Integrations</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Notebooks / Science Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/notebook_summaries.html">Notebook Summaries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/lsst_filters.html">LSST Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/pwv_eff_on_black_body.html">Effective PWV on a Black Body</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/sne_delta_mag.html">PWV effects on SN Magnitude</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/pwv_modeling.html">PWV Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/simulating_lc_for_cadence.html">Simulating Light-Curves with a Cadence</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/models.html">snat_sim.models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/pipeline/pipeline.html">snat_sim.pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/utils/utils.html">snat_sim.utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/data_paths.html">snat_sim.data_paths</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/constants.html">snat_sim.constants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/plasticc.html">snat_sim.plasticc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/plotting.html">snat_sim.plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/sn_magnitudes.html">snat_sim.sn_magnitudes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/cli.html">snat_sim.cli</a></li>
</ul>

    
  </div>
</div>
      
    </div>
  </div>
        <div id="right-column">

          <div class="document clearer body">
            
  <h1>Source code for snat_sim.cli</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Commandline interface for simulating light-curves with atmospheric effects</span>
<span class="sd">and then fitting them with a given SN model.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">from</span> <span class="nn">pwv_kpno.gps_pwv</span> <span class="kn">import</span> <span class="n">GPSReceiver</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="p">))</span>
<span class="kn">from</span> <span class="nn">snat_sim</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">snat_sim.pipeline</span> <span class="kn">import</span> <span class="n">FittingPipeline</span>

<span class="n">SALT2_PARAMS</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;t0&#39;</span><span class="p">,</span> <span class="s1">&#39;x0&#39;</span><span class="p">,</span> <span class="s1">&#39;x1&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">)</span>
<span class="n">SUOMINET_VALUES</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;PWV&#39;</span><span class="p">,</span> <span class="s1">&#39;SrfcPress&#39;</span><span class="p">,</span> <span class="s1">&#39;SrfcTemp&#39;</span><span class="p">,</span> <span class="s1">&#39;SrfcRH&#39;</span><span class="p">,</span> <span class="s1">&#39;ZenithDelay&#39;</span><span class="p">)</span>
<span class="n">AtmModels</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="n">models</span><span class="o">.</span><span class="n">StaticPWVTrans</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">VariablePWVTrans</span><span class="p">,</span> <span class="n">models</span><span class="o">.</span><span class="n">SeasonalPWVTrans</span><span class="p">]</span>


<div class="viewcode-block" id="AdvancedNamespace"><a class="viewcode-back" href="../../api/cli.html#snat_sim.cli.AdvancedNamespace">[docs]</a><span class="k">class</span> <span class="nc">AdvancedNamespace</span><span class="p">(</span><span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represents parsed command line arguments cast into friendly object types&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_create_pwv_effect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pwv_variability</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AtmModels</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Create a PWV transmission effect for use with supernova models</span>

<span class="sd">        Note: ``pwv_variability`` should be a string!</span>

<span class="sd">        If ``pwv_variability`` represents a numerical value, return a</span>
<span class="sd">        ``StaticPWVTrans`` object set to the given PWV concentration (in mm).</span>

<span class="sd">        If ``pwv_variability`` equals ``epoch``, return a ``VariablePWVTrans``</span>
<span class="sd">        object.</span>

<span class="sd">        If `pwv_variability`` equals ``seasonal``, return a</span>
<span class="sd">        ``SeasonalPWVTrans`` object.</span>

<span class="sd">        Args:</span>
<span class="sd">            pwv_variability (str): Command line value for how to vary PWV as a function of time</span>

<span class="sd">        Returns:</span>
<span class="sd">            A propagation effect usable with a supernova model object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># The command line parser defaults to the pwv variability being a string</span>
        <span class="c1"># even if it is numeric. A typecast is sometimes in order.</span>
        <span class="k">if</span> <span class="n">pwv_variability</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">():</span>
            <span class="n">transmission_effect</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">StaticPWVTrans</span><span class="p">()</span>
            <span class="n">transmission_effect</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">pwv</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">pwv_variability</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">transmission_effect</span>

        <span class="c1"># Model PWV continuously over the year using CTIO data</span>
        <span class="k">elif</span> <span class="n">pwv_variability</span> <span class="o">==</span> <span class="s1">&#39;epoch&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">models</span><span class="o">.</span><span class="n">VariablePWVTrans</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pwv_model</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">pwv_variability</span> <span class="o">==</span> <span class="s1">&#39;seasonal&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">models</span><span class="o">.</span><span class="n">SeasonalPWVTrans</span><span class="o">.</span><span class="n">from_pwv_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pwv_model</span><span class="p">)</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Unknown variability: </span><span class="si">{</span><span class="n">pwv_variability</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pwv_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">models</span><span class="o">.</span><span class="n">PWVModel</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Build a PWV model based on the command line argument&quot;&quot;&quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Building PWV Model...&#39;</span><span class="p">)</span>
        <span class="n">data_cuts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">SUOMINET_VALUES</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">param_bound</span> <span class="o">:=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;cut_</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">data_cuts</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">param_bound</span><span class="p">,</span> <span class="p">]</span>

        <span class="n">primary_year</span><span class="p">,</span> <span class="o">*</span><span class="n">supp_years</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pwv_model_years</span>
        <span class="n">receiver</span> <span class="o">=</span> <span class="n">GPSReceiver</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">receiver_id</span><span class="p">,</span> <span class="n">data_cuts</span><span class="o">=</span><span class="n">data_cuts</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">models</span><span class="o">.</span><span class="n">PWVModel</span><span class="o">.</span><span class="n">from_suominet_receiver</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="n">primary_year</span><span class="p">,</span> <span class="n">supp_years</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fitting_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Parameter boundaries to enforce when fitting light-curves&quot;&quot;&quot;</span>

        <span class="n">fitting_bounds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">SALT2_PARAMS</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">param_bound</span> <span class="o">:=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;bound_</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">fitting_bounds</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_bound</span>

        <span class="k">return</span> <span class="n">fitting_bounds</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">simulation_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">models</span><span class="o">.</span><span class="n">SNModel</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return the Supernova model used for fitting light-curves&quot;&quot;&quot;</span>

        <span class="n">propagation_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_pwv_effect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_variability</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Building supernova simulation model...&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">models</span><span class="o">.</span><span class="n">SNModel</span><span class="p">(</span>
            <span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_source</span><span class="p">,</span>
            <span class="n">effects</span><span class="o">=</span><span class="p">[</span><span class="n">propagation_effect</span><span class="p">],</span>
            <span class="n">effect_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">],</span>
            <span class="n">effect_frames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;obs&#39;</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fitting_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">models</span><span class="o">.</span><span class="n">SNModel</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return the Supernova model used for simulating light-curves&quot;&quot;&quot;</span>

        <span class="n">propagation_effect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_pwv_effect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_variability</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Building supernova fitting model...&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">models</span><span class="o">.</span><span class="n">SNModel</span><span class="p">(</span>
            <span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_source</span><span class="p">,</span>
            <span class="n">effects</span><span class="o">=</span><span class="p">[</span><span class="n">propagation_effect</span><span class="p">],</span>
            <span class="n">effect_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">],</span>
            <span class="n">effect_frames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;obs&#39;</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">catalog</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">models</span><span class="o">.</span><span class="n">VariableCatalog</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The reference star catalog to calibrate simulations with.&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">models</span><span class="o">.</span><span class="n">VariableCatalog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pwv_model</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_stars</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">add_scatter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Whether to include added scatter in the light-curve simulations.&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_scatter</span></div>


<div class="viewcode-block" id="Parser"><a class="viewcode-back" href="../../api/cli.html#snat_sim.cli.Parser">[docs]</a><span class="k">class</span> <span class="nc">Parser</span><span class="p">(</span><span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a command line argument parser&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Parser.__init__"><a class="viewcode-back" href="../../api/cli.html#snat_sim.cli.Parser.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;--cadence&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Observational cadence to assume for the LSST.&#39;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;-s&#39;</span><span class="p">,</span> <span class="s1">&#39;--sim_pool_size&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Total number of workers to spawn for simulating supernova light-curves.&#39;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="s1">&#39;--fit_pool_size&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Total number of workers to spawn for fitting light-curves.&#39;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;-w&#39;</span><span class="p">,</span> <span class="s1">&#39;--write_pool_size&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Total number of workers to spawn for writing data to disk.&#39;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;-i&#39;</span><span class="p">,</span> <span class="s1">&#39;--iter_lim&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">),</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Exit pipeline after processing the given number of light-curves (Useful for profiling).&#39;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="s1">&#39;--out_path&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="n">Path</span><span class="p">,</span>
            <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Output file path (a .csv extension is enforced).&#39;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;--overwrite&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Flag to allow existing results to be overwritten.&#39;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;--write_lc_sims&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Flag to include simulated light curves in the pipeline output file.&#39;</span>
                 <span class="s1">&#39; Note the added IO may noticeably increase the pipeline runtime.&#39;</span>
        <span class="p">)</span>

        <span class="c1">#######################################################################</span>
        <span class="c1"># Light-curve simulation</span>
        <span class="c1">#######################################################################</span>

        <span class="n">simulation_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span>
            <span class="s1">&#39;Light-Curve Simulation&#39;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Options for simulating supernova light-curves.&#39;</span><span class="p">)</span>

        <span class="n">simulation_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;--sim_source&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="s1">&#39;salt2-extended&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The name of the sncosmo spectral template to use when simulating supernova light-curves.&#39;</span>
        <span class="p">)</span>

        <span class="n">simulation_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;--sim_variability&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Rate at which to vary PWV when simulating light-curves.&#39;</span>
                 <span class="s1">&#39; Specify a numerical value for a fixed PWV concentration.&#39;</span>
                 <span class="s1">&#39; Specify &quot;epoch&quot; to vary the PWV per observation.&#39;</span>
        <span class="p">)</span>

        <span class="n">simulation_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;--ref_stars&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;G2&#39;</span><span class="p">,</span> <span class="s1">&#39;M5&#39;</span><span class="p">,</span> <span class="s1">&#39;K2&#39;</span><span class="p">),</span>
            <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Reference star(s) to calibrate simulated SNe against.&#39;</span>
        <span class="p">)</span>

        <span class="c1">#######################################################################</span>
        <span class="c1"># Light-curve fitting</span>
        <span class="c1">#######################################################################</span>

        <span class="n">fitting_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span>
            <span class="s1">&#39;Light-Curve Fitting&#39;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Options for configuring supernova light-curve fits.&#39;</span><span class="p">)</span>

        <span class="n">fitting_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;--fit_source&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="s1">&#39;salt2-extended&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The name of the sncosmo spectral template to use when fitting supernova light-curves.&#39;</span>
        <span class="p">)</span>

        <span class="n">fitting_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;--fit_variability&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Rate at which to vary the assumed PWV when fitting light-curves.&#39;</span>
                 <span class="s1">&#39; Specify a numerical value for a fixed PWV concentration.&#39;</span>
                 <span class="s1">&#39; Specify &quot;epoch&quot; to vary the PWV per observation.&#39;</span>
        <span class="p">)</span>

        <span class="n">fitting_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;--vparams&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;x0&#39;</span><span class="p">,</span> <span class="s1">&#39;x1&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">),</span>
            <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Parameters to vary when fitting light-curves.&#39;</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">SALT2_PARAMS</span><span class="p">:</span>
            <span class="n">fitting_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;--bound_</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">nargs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">help</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Upper and lower bounds for </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s1"> parameter when fitting light-curves (Optional).&#39;</span>
            <span class="p">)</span>

        <span class="c1">#######################################################################</span>
        <span class="c1"># PWV Modeling</span>
        <span class="c1">#######################################################################</span>

        <span class="n">pwv_modeling_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span>
            <span class="s1">&#39;PWV Modeling&#39;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Options used when building the PWV variability model&#39;</span>
                        <span class="s1">&#39; from SuomiNet GPS data.&#39;</span>
        <span class="p">)</span>

        <span class="n">pwv_modeling_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;--receiver_id&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="s1">&#39;ctio&#39;</span>
        <span class="p">)</span>

        <span class="n">pwv_modeling_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;--pwv_model_years&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
            <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="mi">2016</span><span class="p">,</span> <span class="mi">2017</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="n">pwv_modeling_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;--cut_PWV&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
            <span class="n">nargs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Only use measured data points with a PWV value within the given bounds (units of millimeters)&#39;</span>
        <span class="p">)</span>

        <span class="n">data_cut_names</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;surface pressure&#39;</span><span class="p">,</span> <span class="s1">&#39;temperature&#39;</span><span class="p">,</span> <span class="s1">&#39;relative humidity&#39;</span><span class="p">,</span> <span class="s1">&#39;zenith delay&#39;</span><span class="p">)</span>
        <span class="n">data_cut_units</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Millibars&#39;</span><span class="p">,</span> <span class="s1">&#39;Centigrade&#39;</span><span class="p">,</span> <span class="s1">&#39;Percentage&#39;</span><span class="p">,</span> <span class="s1">&#39;Millimeters&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">arg</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">unit</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">SUOMINET_VALUES</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">data_cut_names</span><span class="p">,</span> <span class="n">data_cut_units</span><span class="p">):</span>
            <span class="n">pwv_modeling_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;--cut_</span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
                <span class="n">nargs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">help</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Only use measured data points with a </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1"> value within the given bounds (units of </span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s1">)&#39;</span>
            <span class="p">)</span>

        <span class="n">debugging_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span>
            <span class="s1">&#39;Debugging / Validation&#39;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Options used when debugging pipeline behavior.&#39;</span>
        <span class="p">)</span>

        <span class="n">debugging_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;--no-scatter&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Flag used to turn off added scatter when simulating light-curves.&#39;</span>
        <span class="p">)</span>

        <span class="n">debugging_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;--fixed-snr&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Simulate light-curves with a fixed signal to noise ratio.&#39;</span>
        <span class="p">)</span>

        <span class="c1">#######################################################################</span>
        <span class="c1"># Pipeline Visualization</span>
        <span class="c1">#######################################################################</span>

        <span class="n">visualizer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Pipeline Visualization&#39;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Optionally launch a server instance for monitoring the pipeline in real time.&#39;</span><span class="p">)</span>

        <span class="n">visualizer</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;--visualize&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Flag used to launch a web server for visualizing the current pipeline status.&#39;</span>
        <span class="p">)</span>

        <span class="n">visualizer</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;--host&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Optionally define the host IP used to serve the application from.&#39;</span>
        <span class="p">)</span>

        <span class="n">visualizer</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;--port&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Optionally define the port used to serve the application.&#39;</span>
        <span class="p">)</span>

        <span class="n">visualizer</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;--proxy&#39;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Optionally use a proxy to serve the application to a different URL &quot;</span><span class="si">{input}</span><span class="s1">::</span><span class="si">{output}</span><span class="s1">&quot;.&#39;</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Parser.execute"><a class="viewcode-back" href="../../api/cli.html#snat_sim.cli.Parser.execute">[docs]</a>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run the analysis pipeline&quot;&quot;&quot;</span>

        <span class="n">parsed_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">namespace</span><span class="o">=</span><span class="n">AdvancedNamespace</span><span class="p">())</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Instantiating pipeline (target: </span><span class="si">{</span><span class="n">parsed_args</span><span class="o">.</span><span class="n">out_path</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">FittingPipeline</span><span class="p">(</span>
            <span class="n">cadence</span><span class="o">=</span><span class="n">parsed_args</span><span class="o">.</span><span class="n">cadence</span><span class="p">,</span>
            <span class="n">sim_model</span><span class="o">=</span><span class="n">parsed_args</span><span class="o">.</span><span class="n">simulation_model</span><span class="p">,</span>
            <span class="n">fit_model</span><span class="o">=</span><span class="n">parsed_args</span><span class="o">.</span><span class="n">fitting_model</span><span class="p">,</span>
            <span class="n">vparams</span><span class="o">=</span><span class="n">parsed_args</span><span class="o">.</span><span class="n">vparams</span><span class="p">,</span>
            <span class="n">out_path</span><span class="o">=</span><span class="n">parsed_args</span><span class="o">.</span><span class="n">out_path</span><span class="p">,</span>
            <span class="n">simulation_pool</span><span class="o">=</span><span class="n">parsed_args</span><span class="o">.</span><span class="n">sim_pool_size</span><span class="p">,</span>
            <span class="n">fitting_pool</span><span class="o">=</span><span class="n">parsed_args</span><span class="o">.</span><span class="n">fit_pool_size</span><span class="p">,</span>
            <span class="n">writing_pool</span><span class="o">=</span><span class="n">parsed_args</span><span class="o">.</span><span class="n">write_pool_size</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="n">parsed_args</span><span class="o">.</span><span class="n">fitting_bounds</span><span class="p">,</span>
            <span class="n">iter_lim</span><span class="o">=</span><span class="n">parsed_args</span><span class="o">.</span><span class="n">iter_lim</span><span class="p">,</span>
            <span class="n">catalog</span><span class="o">=</span><span class="n">parsed_args</span><span class="o">.</span><span class="n">catalog</span><span class="p">,</span>
            <span class="n">add_scatter</span><span class="o">=</span><span class="n">parsed_args</span><span class="o">.</span><span class="n">add_scatter</span><span class="p">,</span>
            <span class="n">fixed_snr</span><span class="o">=</span><span class="n">parsed_args</span><span class="o">.</span><span class="n">fixed_snr</span><span class="p">,</span>
            <span class="n">overwrite</span><span class="o">=</span><span class="n">parsed_args</span><span class="o">.</span><span class="n">overwrite</span><span class="p">,</span>
            <span class="n">write_lc_sims</span><span class="o">=</span><span class="n">parsed_args</span><span class="o">.</span><span class="n">write_lc_sims</span>
        <span class="p">)</span>

        <span class="n">pipeline</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">parsed_args</span><span class="o">.</span><span class="n">visualize</span><span class="p">:</span>
            <span class="n">pipeline</span><span class="o">.</span><span class="n">run_async</span><span class="p">()</span>
            <span class="n">pipeline</span><span class="o">.</span><span class="n">visualize</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">pipeline</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div></div>
</pre></div>

          </div>
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">SNAT-SIM</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">snat_sim.cli</a></li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="../../_static/js/bootstrap.js"></script>
  <div class="footer">
    &copy; Copyright 2022, Dark Energy Science Collaboration. Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  </body>
</html>