
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>Simulating Light-Curves with a Cadence &#8212; Supernova Atmospheric Simulation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom_style.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="snat_sim.constants" href="../api/constants.html" />
    <link rel="prev" title="PWV Modeling" href="pwv_modeling.html" />
  
   

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../api/constants.html" title="snat_sim.constants"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="pwv_modeling.html" title="PWV Modeling"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">SNAT-SIM</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Simulating Light-Curves with a Cadence</a></li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar"><a href="
    ../index.html" class="text-logo">SNAT-SIM</a>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="../search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Table Of Contents</h2>
  </div>
  <div class="sidebar-toc">
    
    
      <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/install.html">Installation and Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/data_provenance.html">Data Provenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/integrations.html">Package Integrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/command_line.html">Command Line Interface</a></li>
</ul>
<p class="caption"><span class="caption-text">Notebooks / Science Examples</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="notebook_summaries.html">Notebook Summaries</a></li>
<li class="toctree-l1"><a class="reference internal" href="lsst_filters.html">LSST Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="pwv_eff_on_black_body.html">Effective PWV on a Black Body</a></li>
<li class="toctree-l1"><a class="reference internal" href="sne_delta_mag.html">PWV effects on SN Magnitude</a></li>
<li class="toctree-l1"><a class="reference internal" href="pwv_modeling.html">PWV Modeling</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Simulating Light-Curves with a Cadence</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#The-PLaSTICC-Data">The PLaSTICC Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Simulating-Light-Curves">Simulating Light-Curves</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Adding-Atmospheric-Effects">Adding Atmospheric Effects</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/constants.html">snat_sim.constants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/models.html">snat_sim.models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/plasticc.html">snat_sim.plasticc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/reference_stars.html">snat_sim.reference_stars</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/fitting_pipeline.html">snat_sim.fitting_pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/sn_magnitudes.html">snat_sim.sn_magnitudes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/plotting.html">snat_sim.plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/utils/utils.html">snat_sim.utils</a></li>
</ul>

    
  </div>
</div>
      
    </div>
  </div>
        <div id="right-column">

          <div class="document clearer body">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Simulating-Light-Curves-with-a-Cadence">
<h1>Simulating Light-Curves with a Cadence<a class="headerlink" href="#Simulating-Light-Curves-with-a-Cadence" title="Permalink to this headline">¶</a></h1>
<p>This notebook demonstrates the simulation of normal Type Ia Supernova (SN Ia) light-curves using realistic cadences and atmospheric variability expected from LSST. To achieve this we use data from the PLaSTICC simulations to establish the cadence, light-curve parameters, and location of SNe observed by LSST. Light-curves with customized time-variable PWV transmission effects are then simulated using these parameters.</p>
<p>Plots in this notebook are rendered using a subset of demo PLaSTICC data included ib the project repository. To access a larger data set, configure your working environment as outlined <a class="reference external" href="https://lsstdesc.org/SN-PWV/overview/install.html">in the docs</a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">sys</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;../&#39;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">sncosmo</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">SkyCoord</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">vstack</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">pwv_kpno.gps_pwv</span> <span class="kn">import</span> <span class="n">GPSReceiver</span>

<span class="kn">from</span> <span class="nn">snat_sim</span> <span class="kn">import</span> <span class="n">constants</span> <span class="k">as</span> <span class="n">const</span>
<span class="kn">from</span> <span class="nn">snat_sim</span> <span class="kn">import</span> <span class="n">plasticc</span><span class="p">,</span>  <span class="n">models</span>

</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>

</pre></div>
</div>
</div>
<div class="section" id="The-PLaSTICC-Data">
<h2>The PLaSTICC Data<a class="headerlink" href="#The-PLaSTICC-Data" title="Permalink to this headline">¶</a></h2>
<p>Instead of evaluating different cadences from scratch, we take the PLaSTICC simulations as a starting point. First we check what cadence simulations are available on the notebook’s host server.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plasticc</span><span class="o">.</span><span class="n">get_available_cadences</span><span class="p">()</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;alt_sched&#39;]
</pre></div></div>
</div>
<p>Simulated light-curves are written in the SNANA file format and are distributed across multiple files. We load a light-curve from one of these files and demonstrate the data model below. Each cadence includes simulations run with multiple supernova models. In this notebook we only need simulations for normal SNe (Model 11).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">demo_cadence</span> <span class="o">=</span> <span class="s1">&#39;alt_sched&#39;</span>
<span class="n">demo_cadence_header_files</span> <span class="o">=</span> <span class="n">plasticc</span><span class="o">.</span><span class="n">get_model_headers</span><span class="p">(</span><span class="n">demo_cadence</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Available cadence files:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">demo_cadence_header_files</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Available Light-curves: &#39;</span><span class="p">,</span> <span class="n">plasticc</span><span class="o">.</span><span class="n">count_light_curves</span><span class="p">(</span><span class="n">demo_cadence</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="mi">11</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Available cadence files: 2
Available Light-curves:  115
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Data is loaded into memory in chunks. This cell may take a second.</span>
<span class="n">demo_header_path</span> <span class="o">=</span> <span class="n">demo_cadence_header_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">plasticc_lc</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">plasticc</span><span class="o">.</span><span class="n">iter_lc_for_header</span><span class="p">(</span><span class="n">demo_header_path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Params:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">({</span>
    <span class="s1">&#39;t0&#39;</span><span class="p">:</span> <span class="n">plasticc_lc</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;SIM_PEAKMJD&#39;</span><span class="p">],</span>
    <span class="s1">&#39;x1&#39;</span><span class="p">:</span> <span class="n">plasticc_lc</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;SIM_SALT2x1&#39;</span><span class="p">],</span>
    <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="n">plasticc_lc</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;SIM_SALT2c&#39;</span><span class="p">],</span>
    <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="n">plasticc_lc</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;SIM_REDSHIFT_CMB&#39;</span><span class="p">],</span>
    <span class="s1">&#39;x0&#39;</span><span class="p">:</span> <span class="n">plasticc_lc</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;SIM_SALT2x0&#39;</span><span class="p">]</span>
<span class="p">})</span>

<span class="n">plasticc_lc</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Params:
{&#39;t0&#39;: 61999.68359375, &#39;x1&#39;: -0.7346711158752441, &#39;c&#39;: 0.05709853768348694, &#39;z&#39;: 0.43570369482040405, &#39;x0&#39;: 1.3367582141654566e-05}
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<i>Table length=191</i>
<table id="table139935542889920" class="table-striped table-bordered table-condensed">
<thead><tr><th>MJD</th><th>FLT</th><th>FIELD</th><th>PHOTFLAG</th><th>PHOTPROB</th><th>FLUXCAL</th><th>FLUXCALERR</th><th>PSF_SIG1</th><th>SKY_SIG</th><th>ZEROPT</th><th>SIM_MAGOBS</th></tr></thead>
<thead><tr><th>float64</th><th>str2</th><th>str12</th><th>int32</th><th>float32</th><th>float32</th><th>float32</th><th>float32</th><th>float32</th><th>float32</th><th>float32</th></tr></thead>
<tr><td>61954.3306</td><td>z</td><td>NULL</td><td>0</td><td>0.0</td><td>15.283731</td><td>20.61587</td><td>2.75</td><td>47.32</td><td>30.89</td><td>98.98417</td></tr>
<tr><td>61954.3496</td><td>g</td><td>NULL</td><td>0</td><td>0.0</td><td>3.0582032</td><td>4.2619643</td><td>2.78</td><td>13.68</td><td>31.29</td><td>98.96046</td></tr>
<tr><td>61958.423</td><td>Y</td><td>NULL</td><td>0</td><td>0.0</td><td>-34.665913</td><td>24.074171</td><td>1.89</td><td>74.22</td><td>30.8</td><td>98.98663</td></tr>
<tr><td>61960.3473</td><td>r</td><td>NULL</td><td>0</td><td>0.0</td><td>-2.3959112</td><td>10.888871</td><td>1.54</td><td>83.51</td><td>31.58</td><td>98.97268</td></tr>
<tr><td>61960.3667</td><td>i</td><td>NULL</td><td>0</td><td>0.0</td><td>-11.10509</td><td>10.491764</td><td>1.49</td><td>64.03</td><td>31.29</td><td>98.9793</td></tr>
<tr><td>61962.3822</td><td>r</td><td>NULL</td><td>0</td><td>0.0</td><td>0.25858268</td><td>12.420084</td><td>2.32</td><td>65.6</td><td>31.62</td><td>98.97268</td></tr>
<tr><td>61962.4021</td><td>z</td><td>NULL</td><td>0</td><td>0.0</td><td>15.907692</td><td>15.589854</td><td>1.98</td><td>53.47</td><td>30.97</td><td>98.98417</td></tr>
<tr><td>61965.4071</td><td>i</td><td>NULL</td><td>0</td><td>0.0</td><td>5.3211513</td><td>9.46272</td><td>1.99</td><td>43.6</td><td>31.3</td><td>98.9793</td></tr>
<tr><td>61965.4287</td><td>z</td><td>NULL</td><td>0</td><td>0.0</td><td>2.6012752</td><td>13.66771</td><td>1.95</td><td>47.65</td><td>30.97</td><td>98.98417</td></tr>
<tr><td>61974.3513</td><td>r</td><td>NULL</td><td>0</td><td>0.0</td><td>0.15049838</td><td>4.9526896</td><td>2.35</td><td>22.49</td><td>31.47</td><td>98.97268</td></tr>
<tr><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr>
<tr><td>62460.0252</td><td>z</td><td>NULL</td><td>0</td><td>0.0</td><td>11.420037</td><td>14.9348345</td><td>1.51</td><td>67.81</td><td>30.98</td><td>30.547194</td></tr>
<tr><td>62460.0414</td><td>r</td><td>NULL</td><td>0</td><td>0.0</td><td>-0.52240676</td><td>10.964314</td><td>1.55</td><td>89.11</td><td>31.65</td><td>30.144915</td></tr>
<tr><td>62461.0267</td><td>Y</td><td>NULL</td><td>0</td><td>0.0</td><td>-113.93512</td><td>69.27011</td><td>3.41</td><td>58.24</td><td>30.03</td><td>31.165585</td></tr>
<tr><td>62461.0445</td><td>z</td><td>NULL</td><td>0</td><td>0.0</td><td>-15.905042</td><td>23.246475</td><td>2.57</td><td>62.08</td><td>30.98</td><td>30.558609</td></tr>
<tr><td>62463.0275</td><td>Y</td><td>NULL</td><td>0</td><td>0.0</td><td>47.730938</td><td>29.80475</td><td>1.63</td><td>52.77</td><td>30.04</td><td>31.19087</td></tr>
<tr><td>62463.0456</td><td>u</td><td>NULL</td><td>0</td><td>0.0</td><td>-6.670953</td><td>11.205029</td><td>1.9</td><td>6.76</td><td>29.07</td><td>33.9238</td></tr>
<tr><td>62466.0279</td><td>Y</td><td>NULL</td><td>0</td><td>0.0</td><td>17.758373</td><td>33.12478</td><td>1.77</td><td>54.11</td><td>30.04</td><td>31.228773</td></tr>
<tr><td>62466.0447</td><td>r</td><td>NULL</td><td>0</td><td>0.0</td><td>3.4169402</td><td>3.4735596</td><td>1.71</td><td>22.0</td><td>31.49</td><td>30.2049</td></tr>
<tr><td>62468.0277</td><td>Y</td><td>NULL</td><td>0</td><td>0.0</td><td>6.5977235</td><td>42.13687</td><td>2.19</td><td>56.18</td><td>30.05</td><td>31.254023</td></tr>
<tr><td>62468.0439</td><td>g</td><td>NULL</td><td>0</td><td>0.0</td><td>1.3531196</td><td>3.310382</td><td>2.46</td><td>13.3</td><td>31.4</td><td>33.24203</td></tr>
</table></div>
</div>
<p>Here we reformat the data to be compatible with <code class="docutils literal notranslate"><span class="pre">sncosmo</span></code> so we can easily visualize the light-curve.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">formatted_lc</span> <span class="o">=</span> <span class="n">plasticc</span><span class="o">.</span><span class="n">format_plasticc_sncosmo</span><span class="p">(</span><span class="n">plasticc_lc</span><span class="p">)</span>
<span class="n">sncosmo</span><span class="o">.</span><span class="n">plot_lc</span><span class="p">(</span><span class="n">formatted_lc</span><span class="p">);</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_simulating_lc_for_cadence_10_0.png" src="../_images/notebooks_simulating_lc_for_cadence_10_0.png" />
</div>
</div>
</div>
<div class="section" id="Simulating-Light-Curves">
<h2>Simulating Light-Curves<a class="headerlink" href="#Simulating-Light-Curves" title="Permalink to this headline">¶</a></h2>
<p>Since we need to add in our own atmospheric variability, the pre-tabulated flux values above are of limited use. Instead, we use the PLaSTICC meta-data to establish the cadence and model parameters for each simulated SN. This information is then used to simulate our own light-curves with <code class="docutils literal notranslate"><span class="pre">sncosmo</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">params</span><span class="p">,</span> <span class="n">plasticc_cadence</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ObservedCadence</span><span class="o">.</span><span class="n">from_plasticc</span><span class="p">(</span><span class="n">plasticc_lc</span><span class="p">,</span> <span class="n">zp</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

<span class="n">model_for_sim</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SNModel</span><span class="p">(</span><span class="s1">&#39;salt2-extended&#39;</span><span class="p">)</span>
<span class="n">model_for_sim</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">p</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">model_for_sim</span><span class="o">.</span><span class="n">param_names</span><span class="p">})</span>
<span class="n">model_for_sim</span><span class="o">.</span><span class="n">set_source_peakabsmag</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">betoule_abs_mb</span><span class="p">,</span> <span class="s1">&#39;standard::b&#39;</span><span class="p">,</span> <span class="s1">&#39;AB&#39;</span><span class="p">,</span> <span class="n">cosmo</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">betoule_cosmo</span><span class="p">)</span>
<span class="n">duplicated_lc</span> <span class="o">=</span> <span class="n">model_for_sim</span><span class="o">.</span><span class="n">simulate_lc</span><span class="p">(</span><span class="n">plasticc_cadence</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">duplicated_lc</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<i>Table length=191</i>
<table id="table139937423068128" class="table-striped table-bordered table-condensed">
<thead><tr><th>time</th><th>band</th><th>flux</th><th>fluxerr</th><th>zp</th><th>zpsys</th></tr></thead>
<thead><tr><th>float64</th><th>str15</th><th>float64</th><th>float64</th><th>float64</th><th>str8</th></tr></thead>
<tr><td>61954.3306</td><td>lsst_hardware_z</td><td>18.165153263265275</td><td>47.31999969482422</td><td>30.0</td><td>AB</td></tr>
<tr><td>61954.3496</td><td>lsst_hardware_g</td><td>-9.78260623607518</td><td>13.680000305175781</td><td>30.0</td><td>AB</td></tr>
<tr><td>61958.423</td><td>lsst_hardware_y</td><td>156.28293757950442</td><td>74.22000122070312</td><td>30.0</td><td>AB</td></tr>
<tr><td>61960.3473</td><td>lsst_hardware_r</td><td>31.79172242217522</td><td>83.51000213623047</td><td>30.0</td><td>AB</td></tr>
<tr><td>61960.3667</td><td>lsst_hardware_i</td><td>-145.99539532084322</td><td>64.02999877929688</td><td>30.0</td><td>AB</td></tr>
<tr><td>61962.3822</td><td>lsst_hardware_r</td><td>10.166413127856517</td><td>65.5999984741211</td><td>30.0</td><td>AB</td></tr>
<tr><td>61962.4021</td><td>lsst_hardware_z</td><td>3.835420016135801</td><td>53.470001220703125</td><td>30.0</td><td>AB</td></tr>
<tr><td>61965.4071</td><td>lsst_hardware_i</td><td>72.42234434647247</td><td>43.599998474121094</td><td>30.0</td><td>AB</td></tr>
<tr><td>61965.4287</td><td>lsst_hardware_z</td><td>21.705464784351225</td><td>47.650001525878906</td><td>30.0</td><td>AB</td></tr>
<tr><td>61974.3513</td><td>lsst_hardware_r</td><td>11.298412229157584</td><td>22.526463024740462</td><td>30.0</td><td>AB</td></tr>
<tr><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr>
<tr><td>62460.0252</td><td>lsst_hardware_z</td><td>56.4472583738448</td><td>67.80999755859375</td><td>30.0</td><td>AB</td></tr>
<tr><td>62460.0414</td><td>lsst_hardware_r</td><td>20.818164495136994</td><td>89.11000061035156</td><td>30.0</td><td>AB</td></tr>
<tr><td>62461.0267</td><td>lsst_hardware_y</td><td>123.26399240146775</td><td>58.2400016784668</td><td>30.0</td><td>AB</td></tr>
<tr><td>62461.0445</td><td>lsst_hardware_z</td><td>48.11428241698651</td><td>62.08000183105469</td><td>30.0</td><td>AB</td></tr>
<tr><td>62463.0275</td><td>lsst_hardware_y</td><td>-113.82247961939005</td><td>52.77000045776367</td><td>30.0</td><td>AB</td></tr>
<tr><td>62463.0456</td><td>lsst_hardware_u</td><td>-5.167532076922431</td><td>6.760000228881836</td><td>30.0</td><td>AB</td></tr>
<tr><td>62466.0279</td><td>lsst_hardware_y</td><td>20.91741649350185</td><td>54.11000061035156</td><td>30.0</td><td>AB</td></tr>
<tr><td>62466.0447</td><td>lsst_hardware_r</td><td>-5.211945623758276</td><td>22.0</td><td>30.0</td><td>AB</td></tr>
<tr><td>62468.0277</td><td>lsst_hardware_y</td><td>11.737788161940964</td><td>56.18000030517578</td><td>30.0</td><td>AB</td></tr>
<tr><td>62468.0439</td><td>lsst_hardware_g</td><td>-11.913652747702274</td><td>13.300000190734863</td><td>30.0</td><td>AB</td></tr>
</table></div>
</div>
<p>When comparing our own “duplicated” light-curves with the original PLaSTICC simulations, we care about three things: 1. Do the light-curves have the same time sampling? 2. Do the light-curves have the same parameters (except for x0 which depends on the spectral template and cosmology)? 3. Do the light-curves have a similar SNR?</p>
<p>The time sampling is easily verified by looking at the plotted data:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sncosmo</span><span class="o">.</span><span class="n">plot_lc</span><span class="p">(</span><span class="n">duplicated_lc</span><span class="p">);</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_simulating_lc_for_cadence_15_0.png" src="../_images/notebooks_simulating_lc_for_cadence_15_0.png" />
</div>
</div>
<p>Similarly we can check the light-curve parameters:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">duplicated_lc</span><span class="o">.</span><span class="n">meta</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;z&#39;: 0.43570369482040405,
 &#39;t0&#39;: 61999.68359375,
 &#39;x0&#39;: 1.1405574385929165e-05,
 &#39;x1&#39;: -0.7346711158752441,
 &#39;c&#39;: 0.05709853768348694}
</pre></div></div>
</div>
<p>For the SNR it is more informative to look at a distribution over many light-curves:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">plot_snr_distributions</span><span class="p">(</span><span class="n">lc_list</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">16</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;Plot the SNR distribution in each band for PLaSTICC light-curves and their duplicates</span>

<span class="sd">    Args:</span>
<span class="sd">        lc_list (List[Table]): List of light-curves in the PLaSTICC data model</span>
<span class="sd">        bins          (array): Bins to use when generating the histogram</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Simulate and accumulate duplicate light-curves</span>
    <span class="n">plasticc_lcs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">sncosmo_lcs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">plasticc_lc</span> <span class="ow">in</span> <span class="n">lc_list</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">params</span><span class="p">,</span> <span class="n">plasticc_cadence</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ObservedCadence</span><span class="o">.</span><span class="n">from_plasticc</span><span class="p">(</span><span class="n">plasticc_lc</span><span class="p">,</span> <span class="n">zp</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

            <span class="n">model_for_sim</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SNModel</span><span class="p">(</span><span class="s1">&#39;salt2-extended&#39;</span><span class="p">)</span>
            <span class="n">model_for_sim</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">p</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">model_for_sim</span><span class="o">.</span><span class="n">param_names</span><span class="p">})</span>
            <span class="n">model_for_sim</span><span class="o">.</span><span class="n">set_source_peakabsmag</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">betoule_abs_mb</span><span class="p">,</span> <span class="s1">&#39;standard::b&#39;</span><span class="p">,</span> <span class="s1">&#39;AB&#39;</span><span class="p">,</span> <span class="n">cosmo</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">betoule_cosmo</span><span class="p">)</span>
            <span class="n">duplicated_lc</span> <span class="o">=</span> <span class="n">model_for_sim</span><span class="o">.</span><span class="n">simulate_lc</span><span class="p">(</span><span class="n">plasticc_cadence</span><span class="p">)</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">plasticc_lcs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plasticc</span><span class="o">.</span><span class="n">format_plasticc_sncosmo</span><span class="p">(</span><span class="n">plasticc_lc</span><span class="p">))</span>
        <span class="n">sncosmo_lcs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">duplicated_lc</span><span class="p">)</span>

    <span class="n">combined_plasticc</span> <span class="o">=</span> <span class="n">vstack</span><span class="p">(</span><span class="n">plasticc_lcs</span><span class="p">,</span> <span class="n">metadata_conflicts</span><span class="o">=</span><span class="s1">&#39;silent&#39;</span><span class="p">)</span>
    <span class="n">combined_sncosmo</span> <span class="o">=</span> <span class="n">vstack</span><span class="p">(</span><span class="n">sncosmo_lcs</span><span class="p">,</span> <span class="n">metadata_conflicts</span><span class="o">=</span><span class="s1">&#39;silent&#39;</span><span class="p">)</span>
    <span class="n">lc_data_sets</span> <span class="o">=</span> <span class="p">[</span><span class="n">combined_plasticc</span><span class="p">,</span> <span class="n">combined_sncosmo</span><span class="p">]</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">combined_data</span><span class="p">,</span> <span class="n">axis_row</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">lc_data_sets</span><span class="p">,</span> <span class="n">axes</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">band</span><span class="p">,</span> <span class="n">axis</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="s1">&#39;ugrizy&#39;</span><span class="p">,</span> <span class="n">axis_row</span><span class="p">):</span>
            <span class="n">band_data</span> <span class="o">=</span> <span class="n">combined_data</span><span class="p">[</span><span class="n">combined_data</span><span class="p">[</span><span class="s1">&#39;band&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;lsst_hardware_&#39;</span> <span class="o">+</span> <span class="n">band</span><span class="p">]</span>
            <span class="n">snr</span> <span class="o">=</span> <span class="p">(</span><span class="n">band_data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">band_data</span><span class="p">[</span><span class="s1">&#39;fluxerr&#39;</span><span class="p">])</span>
            <span class="n">avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">snr</span><span class="p">)</span>
            <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">snr</span><span class="p">)</span>

            <span class="n">axis</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">snr</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">avg</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Average = </span><span class="si">{</span><span class="n">avg</span><span class="si">:</span><span class="s1"> .2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">avg</span> <span class="o">-</span> <span class="n">std</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Stdev = </span><span class="si">{</span><span class="n">std</span><span class="si">:</span><span class="s1"> .2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">avg</span> <span class="o">+</span> <span class="n">std</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

            <span class="n">axis</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">band</span><span class="p">)</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">bins</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">bins</span><span class="p">))</span>
            <span class="n">axis</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="n">axis_row</span><span class="p">:</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;SNR&#39;</span><span class="p">)</span>

    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;PLaSTICC&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;SNCosmo&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># This line may take a moment while the image renders</span>
<span class="n">plot_snr_distributions</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">plasticc</span><span class="o">.</span><span class="n">iter_lc_for_header</span><span class="p">(</span><span class="n">demo_header_path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)))</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_simulating_lc_for_cadence_20_0.png" src="../_images/notebooks_simulating_lc_for_cadence_20_0.png" />
</div>
</div>
</div>
<div class="section" id="Adding-Atmospheric-Effects">
<h2>Adding Atmospheric Effects<a class="headerlink" href="#Adding-Atmospheric-Effects" title="Permalink to this headline">¶</a></h2>
<p>To simulate light-curves with PWV effects, we need a model for the PWV over time. This is easily defined as follows:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ctio</span> <span class="o">=</span> <span class="n">GPSReceiver</span><span class="p">(</span><span class="s1">&#39;CTIO&#39;</span><span class="p">,</span> <span class="n">data_cuts</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;PWV&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">)]})</span>
<span class="n">ctio</span><span class="o">.</span><span class="n">download_available_data</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">2018</span><span class="p">))</span>
<span class="n">pwv_model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PWVModel</span><span class="o">.</span><span class="n">from_suominet_receiver</span><span class="p">(</span><span class="n">ctio</span><span class="p">,</span> <span class="mi">2016</span><span class="p">,</span> <span class="p">[</span><span class="mi">2017</span><span class="p">])</span>

</pre></div>
</div>
</div>
<p>Next we need a SN Model that incorporates the PWV concentration along line of sight (i.e. the PWV scaled for the airmass at the time of observation). The <code class="docutils literal notranslate"><span class="pre">sncosmo</span></code> package doesn’t have a clearly defined approach to adding time variable propagation effects. We use custom classes from the <code class="docutils literal notranslate"><span class="pre">snat_sim</span></code> package instead, which mimic <code class="docutils literal notranslate"><span class="pre">sncosmo</span></code> but include time variable propagation effects.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pwv_effect</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">VariablePWVTrans</span><span class="p">(</span><span class="n">pwv_model</span><span class="p">)</span>

<span class="n">demo_model_with_pwv</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SNModel</span><span class="p">(</span>
    <span class="n">source</span><span class="o">=</span><span class="s1">&#39;salt2-extended&#39;</span><span class="p">,</span>
    <span class="n">effects</span><span class="o">=</span><span class="p">[</span><span class="n">pwv_effect</span><span class="p">],</span>
    <span class="n">effect_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">],</span>
    <span class="n">effect_frames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;obs&#39;</span><span class="p">]</span>
<span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">plot_variable_pwv_sn_model</span><span class="p">(</span><span class="n">model_with_pwv</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Over plot a sncosmo model with and without temporally variable PWV</span>

<span class="sd">    Args:</span>
<span class="sd">        model_with_pwv (snat_sim.SNModel): sncosmo source to plot</span>
<span class="sd">        phase                     (float): Phase of the supernova to plot</span>
<span class="sd">        params                     (dict): Non-PWV related parameters for the model</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">params</span> <span class="o">=</span> <span class="n">params</span> <span class="ow">or</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="mi">12000</span><span class="p">)</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">phase</span> <span class="o">+</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;t0&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">model_without_pwv</span> <span class="o">=</span> <span class="n">sncosmo</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">model_with_pwv</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>
    <span class="n">model_without_pwv</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">model_without_pwv</span><span class="o">.</span><span class="n">param_names</span><span class="p">})</span>
    <span class="n">flux_without_pwv</span> <span class="o">=</span> <span class="n">model_without_pwv</span><span class="o">.</span><span class="n">flux</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">wave</span><span class="p">)</span>

    <span class="n">model_with_pwv</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="n">flux_with_pwv</span> <span class="o">=</span> <span class="n">model_with_pwv</span><span class="o">.</span><span class="n">flux</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">wave</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">flux_without_pwv</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Base Model&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">flux_with_pwv</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Model with PWV&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Simulated Flux&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Flux&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength (A)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">wave</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">wave</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_variable_pwv_sn_model</span><span class="p">(</span>
    <span class="n">demo_model_with_pwv</span><span class="p">,</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="mf">0.752069652</span><span class="p">,</span>
        <span class="s1">&#39;x0&#39;</span><span class="p">:</span> <span class="mf">3e-06</span><span class="p">,</span>
        <span class="s1">&#39;x1&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.8</span><span class="p">,</span>
        <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_simulating_lc_for_cadence_26_0.png" src="../_images/notebooks_simulating_lc_for_cadence_26_0.png" />
</div>
</div>
<p>The PWV along line of sight is equivalent to the PWV at zenith times the airmass of the observation. We quickly validate the airmass calculation of the <code class="docutils literal notranslate"><span class="pre">VariablePWVTrans</span></code> class.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">plot_airmass_validation</span><span class="p">(</span><span class="n">cadence_name</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">mjd</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot the airmass of simulated PLaSTICC SNe locations as observed from LSST</span>

<span class="sd">    Args:</span>
<span class="sd">        cadence_name (str): Simulated PLaSTICC cadence to plot SNe for</span>
<span class="sd">        model        (int): Model number used in the PLaSTICC simulation</span>
<span class="sd">        mjd        (float): Date to plot airmasses for</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ra</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dec</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">peak</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">header_path</span> <span class="o">=</span> <span class="n">plasticc</span><span class="o">.</span><span class="n">get_model_headers</span><span class="p">(</span><span class="n">cadence_name</span><span class="p">,</span> <span class="n">model</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">header_data</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">header_path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">ra</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">header_data</span><span class="p">[</span><span class="s1">&#39;RA&#39;</span><span class="p">])</span>
    <span class="n">dec</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">header_data</span><span class="p">[</span><span class="s1">&#39;DECL&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">mjd</span> <span class="o">==</span> <span class="s1">&#39;peak&#39;</span><span class="p">:</span>
        <span class="n">peak</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">header_data</span><span class="p">[</span><span class="s1">&#39;PEAKMJD&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">mjd</span> <span class="o">==</span> <span class="s1">&#39;peak&#39;</span><span class="p">:</span>
        <span class="n">mjd</span> <span class="o">=</span> <span class="n">peak</span>

    <span class="n">airmass</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PWVModel</span><span class="o">.</span><span class="n">calc_airmass</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">mjd</span><span class="p">,</span> <span class="n">ra</span><span class="o">=</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="o">=</span><span class="n">dec</span><span class="p">)</span>
    <span class="n">is_positive_airmass</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">airmass</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span>
    <span class="n">positive_airmass</span> <span class="o">=</span> <span class="n">airmass</span><span class="p">[</span><span class="n">is_positive_airmass</span><span class="p">]</span>

    <span class="n">sn_coord</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span><span class="o">.</span><span class="n">galactic</span>
    <span class="n">positive_coords</span> <span class="o">=</span> <span class="n">sn_coord</span><span class="p">[</span><span class="n">is_positive_airmass</span><span class="p">]</span>
    <span class="n">negative_coords</span> <span class="o">=</span> <span class="n">sn_coord</span><span class="p">[</span><span class="o">~</span><span class="n">is_positive_airmass</span><span class="p">]</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;aitoff&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">scat</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">positive_coords</span><span class="o">.</span><span class="n">l</span><span class="o">.</span><span class="n">wrap_at</span><span class="p">(</span><span class="s1">&#39;180d&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">radian</span><span class="p">,</span> <span class="n">positive_coords</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">radian</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">positive_airmass</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">negative_coords</span><span class="o">.</span><span class="n">l</span><span class="o">.</span><span class="n">wrap_at</span><span class="p">(</span><span class="s1">&#39;180d&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">radian</span><span class="p">,</span> <span class="n">negative_coords</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">radian</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Over Horizon&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">framealpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scat</span><span class="p">)</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Airmass&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_airmass_validation</span><span class="p">(</span><span class="n">demo_cadence</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_simulating_lc_for_cadence_29_0.png" src="../_images/notebooks_simulating_lc_for_cadence_29_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../api/constants.html" title="snat_sim.constants"
             >next</a> |</li>
        <li class="right" >
          <a href="pwv_modeling.html" title="PWV Modeling"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">SNAT-SIM</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Simulating Light-Curves with a Cadence</a></li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="../_static/js/bootstrap.js"></script>
  <div class="footer">
    &copy; Copyright 2020, Dark Energy Science Collaboration. Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  </body>
</html>